javascript:(function(){
function showToast(t,e=3000){
  if(!document.getElementById("mobile-toast-container")){
    const c=document.createElement("div");
    c.id="mobile-toast-container";
    c.style="position:fixed;top:15px;left:50%;transform:translateX(-50%);z-index:99999;max-width:320px;text-align:center";
    document.body.appendChild(c);
  }
  const o=document.createElement("div");
  o.textContent=t;
  o.style="background:#333;color:#fff;padding:8px 12px;margin-top:8px;border-radius:8px;cursor:pointer;font-size:13px;display:inline-block;box-shadow:0 2px 6px rgba(0,0,0,.3)";
  o.onclick=()=>o.remove();
  document.getElementById("mobile-toast-container").appendChild(o);
  e>0&&setTimeout(()=>o.remove(),e);
}

function sendSocketPayload(cmd,data){
  if(typeof window._realSocket_==="undefined"||window._realSocket_.readyState!==1){
    console.warn("âš  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ WebSocket Ø¬Ø§Ù‡Ø²");
    return false;
  }
  try{
    window._realSocket_.send("42"+JSON.stringify(["msg",{cmd,data}]));
    return true;
  }catch(e){
    console.error("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:",e);
    return false;
  }
}

// ğŸŸ¢ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â†” Ø§Ù„ØºØ±ÙØ©
const userRoomMap = {};
const roomNames = {};

// ğŸŸ¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±
if(window._realSocket_){
  window._realSocket_.addEventListener("message",function(event){
    try{
      const data=event.data;
      if(typeof data==="string"&&data.startsWith("42")){
        const payload=JSON.parse(data.slice(2));
        const [eventName,content]=payload;
        if(eventName==="msg"&&content?.cmd==="wr"&&Array.isArray(content.data)){
          const [userId,roomId]=content.data;
          userRoomMap[userId]=roomId;
          const roomEl=document.querySelector(`.room.r${roomId}`);
          const roomName=roomEl?.querySelector(".u-topic")?.textContent.trim();
          if(roomName) roomNames[roomId]=roomName;
        }
      }
    }catch(e){}
  });
}

// ğŸŸ¢ Ø±Ø¨Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ±
function bindProfileElement(el){
  const status=el.querySelector('img[src*="s4.png"]'),
        uid=[...el.classList].find(c=>c.startsWith("uid"));
  if(status&&uid){
    el.style.cursor="pointer";
    el.onclick=()=>{
      const id=uid.replace("uid","");
      const topic=el.querySelector(".u-topic")?.textContent.trim()||"";
      window.cpShowProfile?.show ? window.cpShowProfile.show(id,topic) : alert("Ù†Ø§ÙØ°Ø© Ø´Ùˆ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø© Ø¨Ø¹Ø¯");
    };
  }
}

// ğŸŸ¢ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
if(!document.getElementById("cp-showprofile-modal")){
  const style=document.createElement("style");
  style.textContent=`
    #cp-showprofile-modal{position:fixed;z-index:100000;top:50%;left:50%;transform:translate(-50%,-50%);background:#0f0f12;color:#fff;border-radius:10px;box-shadow:0 8px 40px rgba(0,0,0,.6);width:320px;max-width:92%;font-family:Arial}
    #cp-showprofile-header{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.04);font-weight:700;text-align:center;display:flex;justify-content:space-between;align-items:center}
    #cp-showprofile-body{padding:12px 14px;display:flex;gap:8px;justify-content:space-between}
    .cp-sp-btn{flex:1;background:#17171b;border:1px solid rgba(255,255,255,.04);color:#fff;padding:10px;border-radius:8px;text-align:center;cursor:pointer;font-size:14px}
    .cp-sp-btn:hover{background:#262629}
    .cp-sp-btn.active{background:#1a73e8;color:#fff;font-weight:bold}
    #cp-sp-notify-box{display:none;padding:12px 14px;border-top:1px solid rgba(255,255,255,.04)}
    #cp-sp-notify-box textarea{width:100%;height:74px;resize:vertical;border-radius:6px;padding:8px;background:#0b0b0d;color:#fff;border:1px solid rgba(255,255,255,.06)}
    #cp-sp-actions{display:flex;gap:8px;margin-top:8px}
    .cp-sp-small{flex:1;padding:8px;border-radius:6px;background:#1a73e8;border:none;color:#fff;cursor:pointer}
    .cp-sp-small.secondary{background:#777}
    .cp-sp-close{position:absolute;right:10px;top:8px;background:transparent;border:none;color:rgba(255,255,255,.6);cursor:pointer;font-size:20px}
    #cp-showprofile-meta{padding:8px 14px;font-size:13px;color:rgba(255,255,255,.8);border-bottom:1px solid rgba(255,255,255,.03);display:flex;justify-content:space-between;align-items:center}
    #cp-room-box{background:#803838;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;}
  `;
  document.head.appendChild(style);

  const modal=document.createElement("div");
  modal.id="cp-showprofile-modal";
  modal.style.display="none";
  modal.innerHTML=`
    <button class="cp-sp-close" aria-label="close">&times;</button>
    <div id="cp-showprofile-header">Ø´Ùˆ Ø¨Ø±ÙˆÙØ§ÙŠÙ„</div>
    <div id="cp-showprofile-meta">
      <span id="cp-user-name"></span>
      <span id="cp-room-box"></span>
    </div>
    <div id="cp-showprofile-body">
      <div class="cp-sp-btn" id="cp-sp-private">Ù…Ø­Ø§Ø¯Ø«Ø©</div>
      <div class="cp-sp-btn" id="cp-sp-notify">ØªÙ†Ø¨ÙŠÙ‡</div>
      <div class="cp-sp-btn" id="cp-sp-like">Ø¥Ø¹Ø¬Ø§Ø¨</div>
    </div>
    <div id="cp-sp-notify-box">
      <textarea id="cp-sp-notify-txt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..."></textarea>
      <div id="cp-sp-actions">
        <button class="cp-sp-small" id="cp-sp-send-not">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
        <button class="cp-sp-small secondary" id="cp-sp-cancel-not">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  const close=modal.querySelector(".cp-sp-close"),
        like=modal.querySelector("#cp-sp-like"),
        notify=modal.querySelector("#cp-sp-notify"),
        chat=modal.querySelector("#cp-sp-private"),
        box=modal.querySelector("#cp-sp-notify-box"),
        input=modal.querySelector("#cp-sp-notify-txt"),
        send=modal.querySelector("#cp-sp-send-not"),
        cancel=modal.querySelector("#cp-sp-cancel-not"),
        userNameSpan=modal.querySelector("#cp-user-name"),
        roomBox=modal.querySelector("#cp-room-box");

  close.onclick=()=>hide();
  cancel.onclick=()=>{input.value="";hideNotify();};

  let target={userId:null,username:null};

  function show(id,name){
    target.userId=id;
    target.username=name||"";
    userNameSpan.textContent=name||id;

    // ğŸŸ¢ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©
    const roomId=userRoomMap[id];
    let roomName="Ù„ÙŠØ³ ÙÙŠ ØºØ±ÙØ©";
    if(roomId){ roomName = roomNames[roomId] || `Ù…Ø¹Ø±Ù Ø±ÙˆÙ…: ${roomId}`; }
    roomBox.textContent = roomName;

    input.value="";
    hideNotify();
    modal.style.display="block";
  }

  function hide(){modal.style.display="none";target={userId:null,username:null};}
  function showNotify(){box.style.display="block";}
  function hideNotify(){box.style.display="none";}

  like.onclick=()=>{
    const id=target.userId;
    if(!id)return console.warn("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù");
    sendSocketPayload("ccvimn",{cmd:"like",id})?
      (showToast("âœ… Ø£ÙØ±Ø³Ù„ Ø¥Ø¹Ø¬Ø§Ø¨ Ø¥Ù„Ù‰ "+(target.username||id),3000),like.classList.add("active"),setTimeout(()=>like.classList.remove("active"),1500)):
      showToast("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨",4000);
  };

  notify.onclick=()=>{showNotify();};

  send.onclick=()=>{
    const msg=input.value.trim(),id=target.userId;
    if(!msg)return alert("Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø£ÙˆÙ„Ø§Ù‹");
    if(!id)return console.warn("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù");
    sendSocketPayload("ccvimn",{cmd:"not",id,msg})?
      (showToast("âœ… Ø£ÙØ±Ø³Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡",3000),input.value="",hideNotify(),hide()):
      alert("âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„");
  };

  chat.onclick=()=>{
    const id=target.userId;
    id ? (typeof openw==="function" ? (openw(id,!0),hide()) : showToast("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: Ø§Ù„Ø¯Ø§Ù„Ø© openw ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",4000)) : console.warn("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù");
  };

  window.cpShowProfile={show,hide};
}

// ğŸŸ¢ Ø±Ø¨Ø· ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© + Ù…ØªØ§Ø¨Ø¹Ø© Ø£ÙŠ Ø¹Ù†Ø§ØµØ± Ø¬Ø¯ÙŠØ¯Ø©
document.querySelectorAll("div").forEach(bindProfileElement);
new MutationObserver(m=>{
  m.forEach(n=>{
    n.addedNodes.forEach(el=>{
      if(el.nodeType===1){
        bindProfileElement(el);
        el.querySelectorAll && el.querySelectorAll("div").forEach(bindProfileElement);
      }
    });
  });
}).observe(document.body,{childList:true,subtree:true});
})();
